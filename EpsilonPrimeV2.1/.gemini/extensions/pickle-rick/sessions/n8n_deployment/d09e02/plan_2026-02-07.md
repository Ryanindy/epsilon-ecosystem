# n8n Persistence Implementation Plan (PM2)

## Overview
Transition the loose n8n Node.js process to a managed PM2 process to ensure automatic restarts, logging, and persistence across reboots.

## Current State Analysis
- **Process**: Loose `node` process (PID 34604) started manually.
- **Binary**: `C:\Users\Media Server\AppData\Roaming
pm
ode_modules
8n\bin
8n`
- **Port**: 5678
- **PM2**: Version 6.0.14 is installed and daemonized.

## Implementation Approach
We will stop the existing process and use PM2 to launch n8n. We will name the process `n8n-sovereign` and use `pm2 save` to ensure persistence.

## Phase 1: Transition to PM2
### Overview
Terminate the unmanaged process and launch the managed one.

### Changes Required:
#### 1. Command Line Execution
**Action**: Stop existing process and start PM2.
```powershell
Stop-Process -Id 34604 -Force
pm2 start "C:\Users\Media Server\AppData\Roaming
pm
ode_modules
8n\bin
8n" --name n8n-sovereign -- start
pm2 save
```

### Success Criteria:
#### Automated:
- [ ] `pm2 list` shows `n8n-sovereign` with status `online`.
- [ ] `curl.exe -I http://localhost:5678` returns 200 OK.
#### Manual:
- [ ] Navigate to https://mediaserver.taild49f5e.ts.net and verify n8n UI loads.

## Phase 2: Persistence Verification
### Overview
Ensure PM2 is configured to start on Windows boot (if possible/needed).

### Changes Required:
#### 1. PM2 Startup
**Action**: Check if `pm2-windows-startup` is installed. If not, suggest installation for full "God Mode".
```powershell
npm list -g pm2-windows-startup
```

### Success Criteria:
#### Manual:
- [ ] Verify `pm2 list` survives a terminal closure.
